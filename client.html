<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Ultimate Ping-Pong</title>
<style>
body{margin:0;background:#071029;color:#fff;font-family:sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh}
canvas{background:#01101a;display:block;margin-top:10px;border:2px solid #fff}
h2{margin:10px 0}
</style>
</head>
<body>
<h2>Ultimate Ping-Pong ðŸŽ®</h2>
<canvas id="gameCanvas" width="960" height="520"></canvas>
<p>Spieler 1: W/S | Spieler 2: Pfeiltasten â†‘/â†“</p>
<script>
// --- GAME STATE ---
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
let state={
  w:960,h:520,
  paddles:[
    {x:30,y:200,w:12,h:120,color:'#10b981',power:0},
    {x:918,y:200,w:12,h:120,color:'#60a5fa',power:0}
  ],
  ball:{x:480,y:260,vx:400,vy:200,r:10,trail:[]},
  scores:[0,0],
  powerups:[],
  targetScore:7,
  tick:0
};
const keys={w:false,s:false,ArrowUp:false,ArrowDown:false};

// --- INPUT ---
window.addEventListener('keydown',e=>keys[e.key]=true);
window.addEventListener('keyup',e=>keys[e.key]=false);

// --- UTILS ---
function clamp(x,a,b){return Math.max(a,Math.min(b,x));}
function random(min,max){return min+Math.random()*(max-min);}
function addPowerup(){ 
  const kinds=['grow','fast','double']; 
  state.powerups.push({x:random(100,state.w-100),y:random(50,state.h-50),kind:kinds[Math.floor(Math.random()*kinds.length)],ttl:12});
}
function beep(f){const a=new AudioContext();const o=a.createOscillator();o.connect(a.destination);o.frequency.value=f;o.start();o.stop(a.currentTime+0.1);}

// --- GAME LOGIC ---
function resetBall(serving=0){
  state.ball.x=state.w/2;
  state.ball.y=state.h/2;
  state.ball.vx=(serving===0?-1:1)*400;
  state.ball.vy=(Math.random()-0.5)*200;
  state.ball.trail=[];
}
function update(dt){
  state.tick+=dt;
  const speed=400;
  // Paddle movement
  if(keys.w) state.paddles[0].y -= speed*dt;
  if(keys.s) state.paddles[0].y += speed*dt;
  if(keys.ArrowUp) state.paddles[1].y -= speed*dt;
  if(keys.ArrowDown) state.paddles[1].y += speed*dt;
  state.paddles.forEach(p=>p.y=clamp(p.y,0,state.h-p.h));

  // Ball movement
  state.ball.x += state.ball.vx*dt;
  state.ball.y += state.ball.vy*dt;
  state.ball.trail.push({x:state.ball.x,y:state.ball.y});
  if(state.ball.trail.length>10) state.ball.trail.shift();

  // Wall bounce
  if(state.ball.y-state.ball.r<0){ state.ball.y=state.ball.r; state.ball.vy*=-1; beep(400);}
  if(state.ball.y+state.ball.r>state.h){ state.ball.y=state.h-state.ball.r; state.ball.vy*=-1; beep(400);}

  // Paddle collisions
  state.paddles.forEach((p,i)=>{
    if(i===0 && state.ball.vx<0 && state.ball.x-state.ball.r<=p.x+p.w){
      if(state.ball.y>=p.y && state.ball.y<=p.y+p.h){ 
        state.ball.x=p.x+p.w+state.ball.r; state.ball.vx*=-1.05; state.ball.vy+=random(-50,50); beep(600);
      }
    } else if(i===1 && state.ball.vx>0 && state.ball.x+state.ball.r>=p.x){
      if(state.ball.y>=p.y && state.ball.y<=p.y+p.h){
        state.ball.x=p.x-state.ball.r; state.ball.vx*=-1.05; state.ball.vy+=random(-50,50); beep(600);
      }
    }
  });

  // Powerup collision
  state.powerups.forEach((pu,index)=>{
    state.paddles.forEach(p=>{
      if(state.ball.x>=pu.x-15 && state.ball.x<=pu.x+15 && state.ball.y>=pu.y-15 && state.ball.y<=pu.y+15){
        // Activate
        if(pu.kind==='grow'){p.h+=40;}
        else if(pu.kind==='fast'){state.ball.vx*=1.2;state.ball.vy*=1.2;}
        else if(pu.kind==='double'){state.scores[i]+=1;}
        state.powerups.splice(index,1);
      }
    });
    pu.ttl-=dt;
  });
  state.powerups=state.powerups.filter(p=>p.ttl>0);

  // Score
  if(state.ball.x+state.ball.r<0){state.scores[1]++; resetBall(1);}
  if(state.ball.x-state.ball.r>state.w){state.scores[0]++; resetBall(0);}
  // Random powerup spawn
  if(Math.random()<0.005) addPowerup();
}

// --- RENDER ---
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // Ball trail
  ctx.strokeStyle='rgba(255,255,255,0.3)'; ctx.lineWidth=2;
  ctx.beginPath();
  state.ball.trail.forEach((t,i)=>{if(i===0)ctx.moveTo(t.x,t.y);else ctx.lineTo(t.x,t.y);});
  ctx.stroke();

  // Paddles
  state.paddles.forEach(p=>{ctx.fillStyle=p.color; ctx.shadowColor=p.color; ctx.shadowBlur=10; ctx.fillRect(p.x,p.y,p.w,p.h); ctx.shadowBlur=0;});

  // Ball
  ctx.beginPath(); ctx.arc(state.ball.x,state.ball.y,state.ball.r,0,Math.PI*2); ctx.fillStyle='#fff'; ctx.shadowColor='#fff'; ctx.shadowBlur=15; ctx.fill(); ctx.shadowBlur=0;

  // Powerups
  state.powerups.forEach(p=>{
    ctx.fillStyle=p.kind==='grow'?'#facc15':p.kind==='fast'?'#f43f5e':'#60a5fa';
    ctx.beginPath(); ctx.arc(p.x,p.y,10,0,Math.PI*2); ctx.fill();
  });

  // Scores
  ctx.fillStyle='#fff'; ctx.font='32px sans-serif';
  ctx.fillText(state.scores[0],canvas.width*0.25,50);
  ctx.fillText(state.scores[1],canvas.width*0.75,50);
}

let last=performance.now();
function loop(now){
  const dt=Math.min(0.05,(now-last)/1000); last=now;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
